<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>GeoNEMO - MapaOut</title>

  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script defer src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <!-- ‚úÖ Turf (√°rea, centroide, distancias) -->
  <script defer src="https://unpkg.com/@turf/turf@6.5.0/turf.min.js"></script>

  <link rel="stylesheet" href="./css/mapaout.css" />
  <script defer src="./js/mapaout.js"></script>
</head>

<body>
  <header class="topbar">
    <div class="brand">
      <div class="brand__dot"></div>
      <div class="brand__txt">
        <div class="brand__title">GeoNEMO ¬∑ MapaOut</div>
        <div class="brand__sub">Salida de an√°lisis: punto consultado + vinculaci√≥n por capas</div>
      </div>
    </div>

    <div class="topbar__right">
      <button id="btnBack" class="btn btn--ghost" type="button">‚Üê Volver</button>

      <div class="dropdown">
        <button id="btnDownloads" class="btn btn--primary" type="button">‚¨á Descargas</button>
        <div id="downloadsMenu" class="dropdown__menu" aria-hidden="true">
          <button id="btnDownloadJSON" class="menuitem" type="button">JSON (resultado)</button>
          <button id="btnDownloadSelectedGeoJSON" class="menuitem" type="button" disabled>GeoJSON (pol√≠gono seleccionado)</button>
          <button id="btnCopyLink" class="menuitem" type="button">Copiar link</button>
        </div>
      </div>
    </div>
  </header>

  <main class="shell">
    <!-- fila superior: mapa + dictamen -->
    <section class="gridTop">
      <div class="card mapCard" aria-label="Mapa">
        <div class="cardHead">
          <div class="cardTitle">Mapa</div>
          <div class="cardHead__right">
            <button id="btnFit" class="btn btn--ghost btnSm" type="button" title="Ajustar vista">‚§¢ Ajustar</button>
          </div>
        </div>

        <div class="mapFrame">
          <div id="map"></div>

          <div class="legend">
            <div class="legend__title">Leyenda</div>
            <div class="legend__row"><span class="swatch swatch--point"></span> Punto consultado</div>
            <div class="legend__row"><span class="swatch swatch--poly"></span> Pol√≠gono seleccionado</div>
          </div>

          <div id="toast" class="toast" aria-live="polite" aria-atomic="true"></div>
        </div>
      </div>

      <div class="card sideCard" aria-label="Resumen">
        <div class="cardHead">
          <div class="cardTitle">Dictamen</div>
        </div>

        <div class="kpiGrid">
          <div class="kpi">
            <div class="kpi__label">Estado</div>
            <div id="kpiStatus" class="badge badge--neutral">‚Äî</div>
          </div>

          <div class="kpi">
            <div class="kpi__label">Distancia m√≠nima</div>
            <div id="kpiDist" class="kpi__value">‚Äî</div>
          </div>

          <div class="kpi kpiFull">
            <div class="kpi__label">Capa dominante</div>
            <div id="kpiLayer" class="kpi__value">‚Äî</div>
          </div>

          <div class="rowBtns kpiFull">
            <button id="btnEvidence" class="btn btn--primary" type="button">Ver evidencia</button>
            <button id="btnTech" class="btn btn--ghost" type="button">Detalles t√©cnicos</button>
          </div>

          <div id="techBox" class="tech tech--hidden kpiFull">
            <div class="tech__grid">
              <div><div class="tech__k">Actualizado</div><div id="techUpdated" class="tech__v">‚Äî</div></div>
              <div><div class="tech__k">Clic</div><div id="techClick" class="tech__v">‚Äî</div></div>
              <div><div class="tech__k">BBOX</div><div id="techBbox" class="tech__v">‚Äî</div></div>
              <div><div class="tech__k">Key localStorage</div><div class="tech__v"><code>geonemo_out_v2</code></div></div>
            </div>
          </div>

          <!-- ‚úÖ NUEVO: Estad√≠grafos (agrupados) -->
          <div class="kpiFull metBlock" style="margin-top:10px;">
            <div class="cardHead" style="padding:0; margin:0 0 8px 0;">
              <div class="cardTitle" style="font-size:14px; opacity:.9;">Estad√≠grafos</div>
            </div>

            <div class="metGroups">

              <!-- üìê Geometr√≠a -->
              <div class="metGroup">
                <div class="metGroup__title">üìê Geometr√≠a</div>

                <div class="metGrid">
                  <div class="metItem">
                    <div class="tech__k">Distancia m√≠nima al borde</div>
                    <div id="metDistBorde" class="tech__v">‚Äî</div>
                  </div>

                  <div class="metItem">
                    <div class="tech__k">Di√°metro equivalente</div>
                    <div id="metDiamEq" class="tech__v">‚Äî</div>
                  </div>
                </div>
              </div>

              <!-- üìç Localizaci√≥n -->
              <div class="metGroup">
                <div class="metGroup__title">üìç Localizaci√≥n</div>

                <div class="metGrid">
                  <div class="metItem">
                    <div class="tech__k">Centroide (grados decimales)</div>
                    <div id="metCentroidDD" class="tech__v">‚Äî</div>
                  </div>

                  <div class="metItem">
                    <div class="tech__k">Centroide (gg:mm:ss)</div>
                    <div id="metCentroidDMS" class="tech__v">‚Äî</div>
                  </div>
                </div>
              </div>

              <!-- üìä Magnitudes -->
              <div class="metGroup">
                <div class="metGroup__title">üìä Magnitudes</div>

                <div class="metGrid">
                  <div class="metItem">
                    <div class="tech__k">Distancia al centroide</div>
                    <div id="metDistCentroid" class="tech__v">‚Äî</div>
                  </div>

                  <div class="metItem metItem--full">
                    <div class="tech__k">Superficie √°rea</div>
                    <div id="metArea" class="tech__v">‚Äî</div>
                  </div>
                </div>
              </div>

            </div>
          </div>
          <!-- /Estad√≠grafos -->
        </div>

      </div>
    </section>

    <!-- tabla capas -->
    <section class="card" aria-label="Vinculaci√≥n por capas">
      <div class="cardHead">
        <div class="cardTitle">Vinculaci√≥n por capas</div>
        <div id="layersCount" class="pill">0</div>
      </div>
      <div id="layersList" class="layers"></div>
    </section>

    <!-- atributos -->
    <section class="card" aria-label="Atributos">
      <div class="cardHead">
        <div class="cardTitle">Atributos del pol√≠gono seleccionado</div>
        <div id="attrsHint" class="muted">Selecciona una capa para ver atributos.</div>
      </div>
      <div id="attrsBox" class="attrs"><div class="muted">Sin selecci√≥n.</div></div>
    </section>

    <div class="footerNote muted">
      * Resultado preliminar de apoyo. No reemplaza pronunciamientos oficiales ni evaluaciones ambientales.
    </div>
  </main>
</body>
</html>
